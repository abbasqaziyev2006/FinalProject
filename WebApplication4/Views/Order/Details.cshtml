@using ECommerceCoza.DAL.DataContext.Entities
@using EcommerceCoza.BLL.ViewModels
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@inject WebApplication4.Services.ICurrencyService CurrencyService
@model OrderViewModel

<main class="pt-90" style="padding-top: 0px;">
    <div class="mb-4 pb-4"></div>
    <section class="my-account container">
        <h2 class="page-title">@Localizer["OrderDetails"]</h2>

        <div class="row">
            <!-- Order Details Table -->
            <div class="col-12">
                <div class="wg-box mt-5 mb-5">
                    <div class="row">
                        <div class="col-6">
                            <h5>@Localizer["OrderedDetails"]</h5>
                        </div>
                        <div class="col-6 text-end">
                            <a class="btn btn-sm btn-danger" asp-action="Index">@Localizer["Back"]</a>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-transaction">
                            <tbody>
                                <tr>
                                    <th>@Localizer["OrderNo"]</th>
                                    <td>@Model.Id</td>
                                    <th>@Localizer["Mobile"]</th>
                                    <td>@(Model.Address?.Phone ?? "N/A")</td>
                                    <th>@Localizer["PostalCode"]</th>
                                    <td>@(Model.Address?.PostalCode ?? "N/A")</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["OrderDate"]</th>
                                    <td>@(Model.FormattedCreatedAt)</td> 
                                    <th>@Localizer["DeliveredDate"]</th>
                                    <td>@(Model.FormattedDeliveredDate)</td>
                                    <th>@Localizer["CanceledDate"]</th>
                                    <td>@(Model.FormattedCanceledDate)</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["OrderStatus"]</th>
                                    <td colspan="5">
                                        @switch (Model.OrderStatus)
                                        {
                                            case OrderStatus.Completed:
                                                <span class="badge bg-success">@Localizer["Completed"]</span>
                                                break;
                                            case OrderStatus.Cancelled:
                                                <span class="badge bg-danger">@Localizer["Cancelled"]</span>
                                                break;
                                            default:
                                                <span class="badge bg-warning">@Model.OrderStatus</span>
                                                break;
                                        }
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ordered Items -->
            <div class="col-12">
                <div class="wg-box wg-table table-all-user">
                    <h5>@Localizer["OrderedItems"]</h5>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>@Localizer["Name"]</th>
                                    <th class="text-center">@Localizer["Price"]</th>
                                    <th class="text-center">@Localizer["Quantity"]</th>
                                    <th class="text-center">@Localizer["Color"]</th>
                                    <th class="text-center">@Localizer["Total"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.OrderDetails)
                                {
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <img src="~/images/products/@item.ProductVariant?.CoverImageName"
                                                     alt="@item.ProductVariant?.ProductName"
                                                     class="me-2"
                                                     style="width: 50px; height: 50px; object-fit: cover;">
                                                <span>@item.ProductVariant?.ProductName</span>
                                            </div>
                                        </td>
                                        <td class="text-center">@CurrencyService.Format(item.ProductVariant?.Priced ?? 0)</td>
                                        <td class="text-center">@item.Quantity</td>
                                        <td class="text-center">@item.ProductVariant?.ColorName</td>
                                        <td class="text-center">@CurrencyService.Format(item.TotalPrice)</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Shipping Address -->
            <div class="col-md-6">
                <div class="wg-box mt-5">
                    <h5>@Localizer["ShippingAddress"]</h5>
                    <div class="my-account__address-item__detail">
                        <p><strong>@Model.Address?.FirstName @Model.Address?.LastName</strong></p>
                        <p>@Model.Address?.Company</p>
                        <p>@Model.Address?.Adress</p>
                        <p>@Model.Address?.City, @Model.Address?.Country</p>
                        <p>@Model.Address?.PostalCode</p>
                        <p><strong>@Localizer["Mobile"]:</strong> @Model.Address?.Phone</p>
                    </div>
                </div>
            </div>

            <!-- Transactions -->
            <div class="col-md-6">
                <div class="wg-box mt-5">
                    <h5>@Localizer["Transactions"]</h5>
                    <table class="table table-striped table-bordered table-transaction">
                        <tbody>
                            <tr>
                                <th>@Localizer["Subtotal"]</th>
                                <td>@CurrencyService.Format(Model.TotalPrice)</td>
                            </tr>
                            <tr>
                                <th>@Localizer["Discount"]</th>
                                <td>-@CurrencyService.Format(Model.DiscountAmount)</td>
                            </tr>
                            <tr>
                                <th>@Localizer["Total"]</th>
                                <td><strong>@CurrencyService.Format(Model.EndPrice)</strong></td>
                            </tr>
                            <tr>
                                <th>@Localizer["PaymentMethod"]</th>
                                <td>@Model.PaymentMethod</td>
                            </tr>
                            <tr>
                                <th>@Localizer["Status"]</th>
                                <td>
                                    <span class="badge bg-success">@Model.OrderStatus</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
</main>